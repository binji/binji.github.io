<!DOCTYPE html>
<head>
  <style>
    body {
      position: absolute;
      display: flex;
      flex-direction: column;
      background-color: #555;
      margin: 0;
      width: 100%;
      height: 100%;
    }
    canvas {
      object-fit: contain;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <canvas width="320" height="240"></canvas>
  <script>
    let data = new Uint8Array([
      0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x2a, 0x07, 0x60,
      0x00, 0x01, 0x7d, 0x60, 0x01, 0x7d, 0x01, 0x7d, 0x60, 0x00, 0x00, 0x60,
      0x02, 0x7d, 0x7d, 0x01, 0x7d, 0x60, 0x06, 0x7d, 0x7d, 0x7d, 0x7d, 0x7d,
      0x7d, 0x01, 0x7d, 0x60, 0x01, 0x7d, 0x01, 0x7f, 0x60, 0x04, 0x7f, 0x7f,
      0x7d, 0x7d, 0x01, 0x7f, 0x02, 0x1a, 0x02, 0x04, 0x4d, 0x61, 0x74, 0x68,
      0x06, 0x72, 0x61, 0x6e, 0x64, 0x6f, 0x6d, 0x00, 0x00, 0x04, 0x4d, 0x61,
      0x74, 0x68, 0x03, 0x73, 0x69, 0x6e, 0x00, 0x01, 0x03, 0x09, 0x08, 0x02,
      0x02, 0x02, 0x03, 0x04, 0x05, 0x06, 0x02, 0x05, 0x03, 0x01, 0x00, 0x06,
      0x06, 0x21, 0x04, 0x7d, 0x01, 0x43, 0x00, 0x00, 0x00, 0x3f, 0x0b, 0x7d,
      0x01, 0x43, 0x00, 0x00, 0x00, 0x3f, 0x0b, 0x7d, 0x01, 0x43, 0xdb, 0x0f,
      0x49, 0x3f, 0x0b, 0x7d, 0x01, 0x43, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x07,
      0x0d, 0x02, 0x03, 0x6d, 0x65, 0x6d, 0x02, 0x00, 0x03, 0x72, 0x75, 0x6e,
      0x00, 0x09, 0x08, 0x01, 0x02, 0x0a, 0x82, 0x0a, 0x08, 0x30, 0x01, 0x01,
      0x7f, 0x03, 0x40, 0x20, 0x00, 0x41, 0x02, 0x74, 0x43, 0x00, 0x00, 0xf0,
      0x42, 0x43, 0x00, 0x00, 0xf0, 0x42, 0x20, 0x00, 0xb2, 0x93, 0x95, 0x38,
      0x02, 0x80, 0x1c, 0x20, 0x00, 0x41, 0x01, 0x6a, 0x22, 0x00, 0x41, 0xf8,
      0x00, 0x48, 0x0d, 0x00, 0x0b, 0x10, 0x03, 0x10, 0x04, 0x0b, 0xf9, 0x02,
      0x02, 0x06, 0x7f, 0x02, 0x7d, 0x41, 0x80, 0x02, 0x21, 0x03, 0x03, 0x40,
      0x41, 0x00, 0x21, 0x01, 0x03, 0x40, 0x20, 0x00, 0x20, 0x00, 0x3a, 0x00,
      0x00, 0x20, 0x01, 0x41, 0x0b, 0x48, 0x04, 0x40, 0x20, 0x03, 0x20, 0x00,
      0x3a, 0x00, 0x00, 0x20, 0x03, 0x20, 0x00, 0x41, 0x01, 0x6a, 0x3a, 0x00,
      0x01, 0x20, 0x03, 0x41, 0x02, 0x6a, 0x21, 0x03, 0x0b, 0x20, 0x02, 0x41,
      0x0b, 0x48, 0x04, 0x40, 0x20, 0x03, 0x20, 0x00, 0x3a, 0x00, 0x00, 0x20,
      0x03, 0x20, 0x00, 0x41, 0x0c, 0x6a, 0x3a, 0x00, 0x01, 0x20, 0x03, 0x41,
      0x02, 0x6a, 0x21, 0x03, 0x0b, 0x20, 0x00, 0x41, 0x01, 0x6a, 0x21, 0x00,
      0x20, 0x01, 0x41, 0x01, 0x6a, 0x22, 0x01, 0x41, 0x0c, 0x48, 0x0d, 0x00,
      0x0b, 0x20, 0x02, 0x41, 0x01, 0x6a, 0x22, 0x02, 0x41, 0x0c, 0x48, 0x0d,
      0x00, 0x0b, 0x41, 0x88, 0x02, 0x21, 0x05, 0x03, 0x40, 0x41, 0x80, 0x02,
      0x10, 0x00, 0x20, 0x05, 0xb2, 0x94, 0xa8, 0x41, 0x01, 0x74, 0x6a, 0x21,
      0x03, 0x20, 0x03, 0x2d, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x21, 0x01, 0x20,
      0x03, 0x2d, 0x00, 0x01, 0x2d, 0x00, 0x00, 0x21, 0x02, 0x20, 0x01, 0x20,
      0x02, 0x47, 0x04, 0x40, 0x20, 0x05, 0x41, 0x01, 0x6b, 0x21, 0x05, 0x20,
      0x03, 0x20, 0x05, 0x41, 0x01, 0x74, 0x2f, 0x01, 0x80, 0x02, 0x3b, 0x01,
      0x00, 0x41, 0x00, 0x21, 0x00, 0x03, 0x40, 0x20, 0x00, 0x2d, 0x00, 0x00,
      0x20, 0x02, 0x46, 0x04, 0x40, 0x20, 0x00, 0x20, 0x01, 0x3a, 0x00, 0x00,
      0x0b, 0x20, 0x00, 0x41, 0x01, 0x6a, 0x22, 0x00, 0x41, 0x90, 0x01, 0x48,
      0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x05, 0x41, 0xf9, 0x00, 0x4a, 0x0d, 0x00,
      0x0b, 0x41, 0x80, 0x02, 0x21, 0x03, 0x41, 0xd0, 0x20, 0x21, 0x04, 0x03,
      0x40, 0x20, 0x03, 0x2d, 0x00, 0x01, 0x21, 0x00, 0x20, 0x00, 0x41, 0x0c,
      0x6f, 0x41, 0x01, 0x74, 0xb2, 0x21, 0x06, 0x20, 0x00, 0x41, 0x0c, 0x6d,
      0x41, 0x01, 0x74, 0xb2, 0x21, 0x07, 0x20, 0x04, 0x20, 0x06, 0x38, 0x02,
      0x00, 0x20, 0x04, 0x20, 0x07, 0x38, 0x02, 0x04, 0x20, 0x04, 0x43, 0x00,
      0x00, 0x00, 0x40, 0x38, 0x02, 0x10, 0x20, 0x00, 0x20, 0x03, 0x2d, 0x00,
      0x00, 0x6b, 0x41, 0x01, 0x46, 0x04, 0x40, 0x20, 0x07, 0x43, 0x00, 0x00,
      0x00, 0x40, 0x92, 0x21, 0x07, 0x05, 0x20, 0x06, 0x43, 0x00, 0x00, 0x00,
      0x40, 0x92, 0x21, 0x06, 0x0b, 0x20, 0x04, 0x20, 0x06, 0x38, 0x02, 0x08,
      0x20, 0x04, 0x20, 0x07, 0x38, 0x02, 0x0c, 0x20, 0x04, 0x41, 0x14, 0x6a,
      0x21, 0x04, 0x20, 0x03, 0x41, 0x02, 0x6a, 0x22, 0x03, 0x41, 0xf2, 0x03,
      0x48, 0x0d, 0x00, 0x0b, 0x0b, 0xa4, 0x01, 0x01, 0x05, 0x7f, 0x41, 0x80,
      0x08, 0x21, 0x00, 0x41, 0x80, 0x0a, 0x21, 0x01, 0x03, 0x40, 0x20, 0x00,
      0x2c, 0x00, 0x00, 0x21, 0x02, 0x20, 0x02, 0x41, 0x00, 0x4a, 0x04, 0x40,
      0x20, 0x00, 0x41, 0x01, 0x6a, 0x21, 0x00, 0x41, 0x00, 0x21, 0x03, 0x05,
      0x41, 0x00, 0x20, 0x02, 0x6b, 0x21, 0x02, 0x41, 0x01, 0x21, 0x03, 0x0b,
      0x03, 0x40, 0x20, 0x00, 0x20, 0x03, 0x6a, 0x21, 0x00, 0x20, 0x00, 0x2d,
      0x00, 0x00, 0x21, 0x04, 0x20, 0x01, 0x20, 0x04, 0x41, 0x03, 0x71, 0x41,
      0x02, 0x74, 0x3a, 0x00, 0x00, 0x20, 0x01, 0x20, 0x04, 0x41, 0x02, 0x76,
      0x41, 0x03, 0x71, 0x41, 0x02, 0x74, 0x3a, 0x00, 0x01, 0x20, 0x01, 0x20,
      0x04, 0x41, 0x04, 0x76, 0x41, 0x03, 0x71, 0x41, 0x02, 0x74, 0x3a, 0x00,
      0x02, 0x20, 0x01, 0x20, 0x04, 0x41, 0x06, 0x76, 0x41, 0x03, 0x71, 0x41,
      0x02, 0x74, 0x3a, 0x00, 0x03, 0x20, 0x01, 0x41, 0x04, 0x6a, 0x21, 0x01,
      0x20, 0x02, 0x41, 0x01, 0x6b, 0x22, 0x02, 0x0d, 0x00, 0x0b, 0x20, 0x00,
      0x41, 0x01, 0x6a, 0x21, 0x00, 0x20, 0x00, 0x41, 0x80, 0x0a, 0x48, 0x0d,
      0x00, 0x0b, 0x0b, 0x0e, 0x00, 0x20, 0x00, 0x20, 0x00, 0x20, 0x01, 0x95,
      0x8f, 0x20, 0x01, 0x94, 0x93, 0x0b, 0x87, 0x01, 0x01, 0x09, 0x7d, 0x23,
      0x00, 0x20, 0x02, 0x93, 0x21, 0x06, 0x23, 0x01, 0x20, 0x03, 0x93, 0x21,
      0x07, 0x20, 0x04, 0x20, 0x02, 0x93, 0x21, 0x08, 0x20, 0x05, 0x20, 0x03,
      0x93, 0x21, 0x09, 0x20, 0x01, 0x8c, 0x21, 0x0a, 0x20, 0x00, 0x21, 0x0b,
      0x43, 0x00, 0x00, 0x80, 0x3f, 0x20, 0x08, 0x20, 0x0a, 0x94, 0x20, 0x09,
      0x20, 0x0b, 0x94, 0x92, 0x95, 0x21, 0x0c, 0x20, 0x06, 0x20, 0x0a, 0x94,
      0x20, 0x07, 0x20, 0x0b, 0x94, 0x92, 0x20, 0x0c, 0x94, 0x21, 0x0e, 0x20,
      0x0e, 0x43, 0x00, 0x00, 0x00, 0x00, 0x60, 0x20, 0x0e, 0x43, 0x00, 0x00,
      0x80, 0x3f, 0x5f, 0x71, 0x04, 0x40, 0x20, 0x08, 0x20, 0x07, 0x94, 0x20,
      0x06, 0x20, 0x09, 0x94, 0x93, 0x20, 0x0c, 0x94, 0x21, 0x0d, 0x20, 0x0d,
      0x43, 0x00, 0x00, 0x00, 0x00, 0x60, 0x04, 0x40, 0x20, 0x0e, 0x24, 0x03,
      0x20, 0x0d, 0x0f, 0x0b, 0x0b, 0x43, 0x00, 0x00, 0x80, 0x7f, 0x0b, 0x16,
      0x00, 0x20, 0x00, 0x20, 0x00, 0x92, 0x21, 0x00, 0x20, 0x00, 0x20, 0x00,
      0x8e, 0x93, 0x43, 0x00, 0x00, 0x00, 0x42, 0x94, 0xa8, 0x0b, 0x1a, 0x00,
      0x20, 0x01, 0x20, 0x00, 0x20, 0x03, 0x10, 0x07, 0x41, 0x05, 0x74, 0x20,
      0x02, 0x10, 0x07, 0x6a, 0x6a, 0x2d, 0x00, 0x00, 0x6a, 0x28, 0x02, 0x00,
      0x0b, 0xe3, 0x03, 0x06, 0x03, 0x7f, 0x06, 0x7d, 0x05, 0x7f, 0x03, 0x7d,
      0x01, 0x7f, 0x02, 0x7d, 0x41, 0xb0, 0x1a, 0x2d, 0x00, 0x00, 0x41, 0xb1,
      0x1a, 0x2d, 0x00, 0x00, 0x6b, 0xb2, 0x43, 0x0a, 0xd7, 0x23, 0x3d, 0x94,
      0x21, 0x0e, 0x23, 0x02, 0x20, 0x0e, 0x92, 0x43, 0xdb, 0x0f, 0xc9, 0x40,
      0x10, 0x05, 0x24, 0x02, 0x23, 0x02, 0x10, 0x01, 0x21, 0x04, 0x23, 0x02,
      0x43, 0xdb, 0x0f, 0xc9, 0x3f, 0x92, 0x10, 0x01, 0x21, 0x05, 0x41, 0xb2,
      0x1a, 0x2d, 0x00, 0x00, 0x04, 0x40, 0x23, 0x00, 0x20, 0x04, 0x43, 0xcd,
      0xcc, 0x4c, 0x3d, 0x94, 0x92, 0x24, 0x00, 0x23, 0x01, 0x20, 0x05, 0x43,
      0xcd, 0xcc, 0x4c, 0x3d, 0x94, 0x92, 0x24, 0x01, 0x0b, 0x03, 0x40, 0x20,
      0x00, 0x41, 0xa0, 0x01, 0x6b, 0xb2, 0x43, 0x00, 0x00, 0x20, 0x43, 0x95,
      0x21, 0x03, 0x43, 0x00, 0x00, 0x80, 0x7f, 0x21, 0x06, 0x41, 0x80, 0x20,
      0x21, 0x02, 0x03, 0x40, 0x20, 0x04, 0x20, 0x03, 0x20, 0x05, 0x8c, 0x94,
      0x92, 0x21, 0x0f, 0x20, 0x05, 0x20, 0x03, 0x20, 0x04, 0x94, 0x92, 0x21,
      0x10, 0x20, 0x0f, 0x20, 0x10, 0x20, 0x02, 0x2a, 0x02, 0x00, 0x20, 0x02,
      0x2a, 0x02, 0x04, 0x20, 0x02, 0x2a, 0x02, 0x08, 0x20, 0x02, 0x2a, 0x02,
      0x0c, 0x10, 0x06, 0x21, 0x08, 0x20, 0x08, 0x20, 0x06, 0x5d, 0x04, 0x40,
      0x20, 0x08, 0x21, 0x06, 0x23, 0x03, 0x20, 0x02, 0x2a, 0x02, 0x10, 0x94,
      0x21, 0x07, 0x0b, 0x20, 0x02, 0x41, 0x14, 0x6a, 0x22, 0x02, 0x41, 0xc4,
      0x33, 0x48, 0x0d, 0x00, 0x0b, 0x43, 0x00, 0x00, 0xf0, 0x42, 0x20, 0x06,
      0x95, 0xa8, 0x21, 0x09, 0x41, 0xf8, 0x00, 0x20, 0x09, 0x6b, 0x21, 0x0a,
      0x41, 0xf8, 0x00, 0x20, 0x09, 0x6a, 0x21, 0x0b, 0x20, 0x0a, 0x41, 0x00,
      0x4c, 0x04, 0x40, 0x41, 0x00, 0x21, 0x0a, 0x0b, 0x20, 0x0b, 0x41, 0xf0,
      0x01, 0x4e, 0x04, 0x40, 0x41, 0xf0, 0x01, 0x21, 0x0b, 0x0b, 0x41, 0x00,
      0x21, 0x01, 0x20, 0x00, 0x41, 0x02, 0x74, 0x21, 0x0c, 0x20, 0x0c, 0x41,
      0x80, 0xe0, 0x12, 0x6a, 0x21, 0x0d, 0x20, 0x0a, 0x04, 0x40, 0x41, 0x00,
      0x21, 0x11, 0x20, 0x0a, 0x21, 0x01, 0x03, 0x40, 0x20, 0x11, 0x2a, 0x02,
      0x80, 0x1c, 0x21, 0x08, 0x20, 0x11, 0x41, 0x04, 0x6a, 0x21, 0x11, 0x23,
      0x00, 0x20, 0x0f, 0x20, 0x08, 0x94, 0x92, 0x21, 0x12, 0x23, 0x01, 0x20,
      0x10, 0x20, 0x08, 0x94, 0x92, 0x21, 0x13, 0x20, 0x0c, 0x41, 0x80, 0x12,
      0x41, 0x90, 0x1a, 0x20, 0x12, 0x20, 0x13, 0x10, 0x08, 0x36, 0x02, 0x80,
      0x60, 0x20, 0x0c, 0x41, 0x80, 0x0a, 0x6a, 0x21, 0x0c, 0x20, 0x0d, 0x41,
      0x80, 0x0a, 0x6b, 0x21, 0x0d, 0x20, 0x0d, 0x41, 0x80, 0x12, 0x41, 0x9c,
      0x1a, 0x20, 0x12, 0x20, 0x13, 0x10, 0x08, 0x36, 0x02, 0x80, 0x60, 0x20,
      0x01, 0x41, 0x01, 0x6b, 0x22, 0x01, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x09,
      0x04, 0x40, 0x20, 0x0a, 0x21, 0x01, 0x03, 0x40, 0x20, 0x0c, 0x41, 0x80,
      0x0a, 0x41, 0x80, 0x1a, 0x20, 0x07, 0x20, 0x01, 0x41, 0xf8, 0x00, 0x20,
      0x09, 0x6b, 0x6b, 0xb2, 0x20, 0x09, 0x41, 0x02, 0x6c, 0xb2, 0x95, 0x10,
      0x08, 0x36, 0x02, 0x80, 0x60, 0x20, 0x0c, 0x41, 0x80, 0x0a, 0x6a, 0x21,
      0x0c, 0x20, 0x01, 0x41, 0x01, 0x6a, 0x22, 0x01, 0x20, 0x0b, 0x48, 0x0d,
      0x00, 0x0b, 0x0b, 0x20, 0x00, 0x41, 0x01, 0x6a, 0x22, 0x00, 0x41, 0xc0,
      0x02, 0x48, 0x0d, 0x00, 0x0b, 0x0b, 0x0b, 0x8c, 0x03, 0x03, 0x00, 0x41,
      0x80, 0x20, 0x0b, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0xc0, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x41,
      0x00, 0x00, 0xc0, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x41,
      0x00, 0x00, 0xc0, 0x41, 0x00, 0x00, 0x40, 0x41, 0x00, 0x00, 0xc0, 0x41,
      0x00, 0x00, 0xc0, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x41,
      0x00, 0x00, 0x40, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x41,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x41,
      0x00, 0x41, 0x80, 0x08, 0x0b, 0x80, 0x02, 0x08, 0xaa, 0x04, 0x00, 0xff,
      0x02, 0x03, 0x00, 0x03, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5,
      0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06,
      0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe,
      0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52,
      0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55,
      0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x03, 0x55, 0x04, 0xff,
      0xff, 0xf2, 0x03, 0xff, 0x08, 0xaa, 0xff, 0x02, 0x07, 0x00, 0xff, 0x52,
      0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55,
      0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5,
      0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06,
      0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe,
      0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52, 0x06, 0x55, 0xfe, 0xd5, 0x52,
      0x06, 0x55, 0xfe, 0xd5, 0xf2, 0x07, 0xff, 0xfe, 0x00, 0x56, 0x05, 0x55,
      0xfd, 0x02, 0x80, 0x56, 0x05, 0x55, 0xfe, 0x0a, 0xa0, 0x06, 0x55, 0xfe,
      0x29, 0x68, 0x06, 0x55, 0xfe, 0xa5, 0x5a, 0x06, 0x55, 0xff, 0x95, 0x3b,
      0x55, 0xfe, 0x95, 0x5a, 0x06, 0x55, 0xfe, 0xa5, 0x68, 0x06, 0x55, 0xfe,
      0x29, 0xa0, 0x06, 0x55, 0xfd, 0x0a, 0x80, 0x56, 0x05, 0x55, 0xfd, 0x02,
      0x00, 0x56, 0x05, 0x55, 0xfd, 0x0a, 0x80, 0x56, 0x05, 0x55, 0xfe, 0x29,
      0xa0, 0x06, 0x55, 0xfe, 0xa5, 0x68, 0x06, 0x55, 0xfe, 0x95, 0x5a, 0x3b,
      0x55, 0xff, 0x5a, 0x06, 0x55, 0xfe, 0x95, 0x68, 0x06, 0x55, 0xfe, 0xa5,
      0xa0, 0x06, 0x55, 0xfd, 0x29, 0x80, 0x56, 0x05, 0x55, 0xff, 0x0a, 0x00,
      0x41, 0x80, 0x1a, 0x0b, 0x28, 0xf3, 0x5f, 0x5f, 0xff, 0x9f, 0x25, 0x25,
      0xff, 0x00, 0x00, 0x00, 0xff, 0x79, 0x0e, 0x0e, 0xff, 0x62, 0x8d, 0xc6,
      0xff, 0x81, 0x95, 0xaf, 0xff, 0x62, 0x8d, 0xc6, 0xff, 0x81, 0x95, 0xaf,
      0xff, 0xb5, 0xb5, 0xb5, 0xff, 0x62, 0x8d, 0xc6, 0xff
    ]);
    let instance = new WebAssembly.Instance(new WebAssembly.Module(data), {Math});
    let canvasData = new Uint8Array(instance.exports.mem.buffer, 0x3000, 307200);
    let canvas = document.querySelector('canvas');
    let context = canvas.getContext('2d');
    let imageData = context.createImageData(320, 240);
    let memory = instance.exports.mem.buffer;

    let u8 = new Uint8Array(instance.exports.mem.buffer, 0xd30, 3);
    let onkey = (down, event) => {
      switch (event.code) {
        case 'ArrowLeft': u8[0] = down; break;
        case 'ArrowRight': u8[1] = down; break;
        case 'ArrowUp': u8[2] = down; break;
      }
      event.preventDefault();
    };
    document.addEventListener('keydown', onkey.bind(null, 1), false);
    document.addEventListener('keyup', onkey.bind(null, 0), false);

    let touches = {};
    let ontouch = (down, event) => {
      for (let touch of event.changedTouches) {
        if (down) {
          if (touch.clientX < event.target.clientWidth * 0.5) {
            index = 0; // left
          } else {
            index = 1; // right
          }
          u8[index] = 1;
          touches[touch.identifier] = index;
        } else {
          u8[touches[touch.identifier]] = 0;
          delete touches[touch.identifier];
        }
      }
      // Move forward when touching left and right side of screen.
      u8[2] = u8[0] & u8[1];
      event.preventDefault();
    };
    canvas.addEventListener('touchstart', ontouch.bind(null, 1), false);
    canvas.addEventListener('touchend', ontouch.bind(null, 0), false);

    let visible = false;
    let rafId = 0;

    function update() {
      rafId = visible ? requestAnimationFrame(update) : 0;
      instance.exports.run();
      imageData.data.set(canvasData);
      context.putImageData(imageData, 0, 0);
    }

    let observer = new IntersectionObserver((entries, observer) => {
      visible = false;
      for (let entry of entries) { visible = visible || entry.isIntersecting; }
      if (visible && rafId === 0) {
        rafId = requestAnimationFrame(update);
      } else if (!visible && rafId !== 0) {
        cancelAnimationFrame(rafId);
        rafId = 0;
      }
    });
    observer.observe(document.querySelector('canvas'));
  </script>
</body>

